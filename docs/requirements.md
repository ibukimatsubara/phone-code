# phone-code è¦ä»¶å®šç¾©æ›¸

## æ¦‚è¦

è‡ªå®…ã‚µãƒ¼ãƒãƒ¼ä¸Šã® tmux ã‚»ãƒƒã‚·ãƒ§ãƒ³(ä¸»ã« Claude Code)ã‚’ã‚¹ãƒãƒ›ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰æ“ä½œã™ã‚‹ãŸã‚ã® Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   Tailscale    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚¹ãƒãƒ›       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚  è‡ªå®…ã‚µãƒ¼ãƒãƒ¼            â”‚
â”‚ (Chrome)    â”‚               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚  â”‚ Node.js           â”‚ â”‚
                              â”‚  â”‚ â”œâ”€ é™çš„Frontendé…ä¿¡ â”‚ â”‚
                              â”‚  â”‚ â”œâ”€ WebSocket       â”‚ â”‚
                              â”‚  â”‚ â””â”€ child_process   â”‚ â”‚
                              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                              â”‚           â”‚ exec        â”‚
                              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                              â”‚  â”‚ tmux               â”‚ â”‚
                              â”‚  â”‚ â”œâ”€ session:main     â”‚ â”‚
                              â”‚  â”‚ â”‚  â”œâ”€ pane:0 claude â”‚ â”‚
                              â”‚  â”‚ â”‚  â””â”€ pane:1 shell  â”‚ â”‚
                              â”‚  â”‚ â””â”€ session:dev      â”‚ â”‚
                              â”‚  â”‚    â””â”€ pane:0 claude â”‚ â”‚
                              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- Web ã‚µãƒ¼ãƒãƒ¼ã¨ tmux ã¯åŒä¸€ãƒã‚·ãƒ³ä¸Šã§å‹•ä½œ
- SSH ä¸è¦ï¼ˆ`child_process.exec` ã§ tmux ã‚³ãƒãƒ³ãƒ‰ã‚’ç›´æ¥å®Ÿè¡Œï¼‰
- Tailscale HTTPS (`tailscale cert`) ã§ã‚»ã‚­ãƒ¥ã‚¢ã«æ¥ç¶š
- Docker Compose ã§å‹•ä½œ

## å‹•ä½œç’°å¢ƒ

| é …ç›® | å†…å®¹ |
|------|------|
| ã‚µãƒ¼ãƒãƒ¼ OS | Linux (è‡ªå®…ã‚µãƒ¼ãƒãƒ¼) |
| ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ | ã‚¹ãƒãƒ›ãƒ–ãƒ©ã‚¦ã‚¶ (Chromeç­‰) |
| ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ | Tailscale VPN |
| èªè¨¼ | Tailscale å†…ã®ãŸã‚ Phase 1 ã§ã¯ä¸è¦ |

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | æŠ€è¡“ | ç†ç”± |
|---------|------|------|
| Backend | Node.js + Express + ws | tmux CLI é€£æºãŒå®¹æ˜“ã€WS ãƒ©ã‚¤ãƒ–ãƒ©ãƒªè±Šå¯Œ |
| Frontend | React + Vite + xterm.js | çŠ¶æ…‹ç®¡ç†(ã‚¿ãƒ–/ã‚µã‚¤ãƒ‰ãƒãƒ¼)ã«é©åˆ‡ã€xterm.js ã¨ã®çµ±åˆå®Ÿç¸¾ |
| ã‚¿ãƒ¼ãƒŸãƒŠãƒ«æç”» | xterm.js + xterm-addon-fit | Web ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã®ãƒ‡ãƒ•ã‚¡ã‚¯ãƒˆ |
| å®Ÿè¡Œç’°å¢ƒ | Docker Compose | ãƒãƒ¼ã‚¿ãƒ–ãƒ«ã€tmux ã‚½ã‚±ãƒƒãƒˆã‚’ãƒã‚¦ãƒ³ãƒˆ |
| ã‚¹ã‚¿ã‚¤ãƒ« | CSS (ãƒ¢ãƒã‚¤ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ) | ã‚¹ãƒãƒ›æ“ä½œãŒä¸»ç›®çš„ |

---

## tmux æ“ä½œæ–¹å¼

### pane å‡ºåŠ›ã®å–å¾— (Server â†’ Client)

`capture-pane` ãƒãƒ¼ãƒªãƒ³ã‚°æ–¹å¼ã‚’æ¡ç”¨ã™ã‚‹ã€‚

```bash
# pane ã®ç¾åœ¨ã®ç”»é¢ã‚’ANSIã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ä»˜ãã§å–å¾—
tmux capture-pane -p -t <session>:<window>.<pane> -e
```

**ãƒãƒ¼ãƒªãƒ³ã‚°ä»•æ§˜:**

| é …ç›® | å€¤ |
|------|-----|
| é–“éš” | 150ms (ç´„6.6fps) |
| å·®åˆ†æ¤œçŸ¥ | ã‚µãƒ¼ãƒãƒ¼å´ã§å‰å›ã®å‡ºåŠ›ã¨æ¯”è¼ƒã—ã€å¤‰åŒ–æ™‚ã®ã¿é€ä¿¡ |
| æç”»æ–¹å¼ | `\x1b[H` (ã‚«ãƒ¼ã‚½ãƒ«HOME) + ã‚­ãƒ£ãƒ—ãƒãƒ£å†…å®¹ã§ä¸Šæ›¸ãæç”» |
| ãƒãƒ©ã¤ãé˜²æ­¢ | ç”»é¢ã‚¯ãƒªã‚¢ã›ãšä¸Šæ›¸ãã®ãŸã‚ç™ºç”Ÿã—ãªã„ |

### å…¥åŠ›ã®é€ä¿¡ (Client â†’ Server)

```bash
# ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›
tmux send-keys -t <session>:<window>.<pane> -l 'ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ'

# ç‰¹æ®Šã‚­ãƒ¼
tmux send-keys -t <session>:<window>.<pane> C-c     # Ctrl+C
tmux send-keys -t <session>:<window>.<pane> C-d     # Ctrl+D
tmux send-keys -t <session>:<window>.<pane> Enter   # Enter
tmux send-keys -t <session>:<window>.<pane> Tab     # Tab
tmux send-keys -t <session>:<window>.<pane> Up      # ä¸ŠçŸ¢å°
tmux send-keys -t <session>:<window>.<pane> Down    # ä¸‹çŸ¢å°
```

### ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ»pane ä¸€è¦§ã®å–å¾—

```bash
# ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§
tmux list-sessions -F '#{session_name}:#{session_windows}:#{session_attached}'

# ç‰¹å®šã‚»ãƒƒã‚·ãƒ§ãƒ³ã® pane ä¸€è¦§
tmux list-panes -t <session> -F '#{window_index}.#{pane_index}:#{pane_current_command}:#{pane_width}x#{pane_height}:#{pane_active}'
```

---

## WebSocket ãƒ—ãƒ­ãƒˆã‚³ãƒ«

### Client â†’ Server

```jsonc
// ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§å–å¾—
{ "type": "sessions" }

// pane ä¸€è¦§å–å¾—
{ "type": "panes", "session": "main" }

// pane å‡ºåŠ›ã®è³¼èª­é–‹å§‹
{ "type": "subscribe", "target": "main:0.1" }

// pane å‡ºåŠ›ã®è³¼èª­è§£é™¤
{ "type": "unsubscribe", "target": "main:0.1" }

// ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›
{ "type": "input", "target": "main:0.1", "data": "ls -la\n" }

// ç‰¹æ®Šã‚­ãƒ¼é€ä¿¡
{ "type": "key", "target": "main:0.1", "key": "C-c" }
```

### Server â†’ Client

```jsonc
// ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§
{
  "type": "sessions",
  "data": [
    { "name": "main", "windows": 1, "attached": true },
    { "name": "dev", "windows": 2, "attached": false }
  ]
}

// pane ä¸€è¦§
{
  "type": "panes",
  "session": "main",
  "data": [
    { "target": "0.0", "command": "claude", "size": "120x40", "active": true },
    { "target": "0.1", "command": "zsh", "size": "120x40", "active": false }
  ]
}

// pane å‡ºåŠ›
{
  "type": "output",
  "target": "main:0.1",
  "data": "...(capture-pane ã®å‡ºåŠ›)..."
}

// ã‚¨ãƒ©ãƒ¼
{
  "type": "error",
  "message": "session not found: xyz"
}
```

---

## UI è¨­è¨ˆ

### ãƒ¡ã‚¤ãƒ³ç”»é¢ (ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒ“ãƒ¥ãƒ¼)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â˜°  session:main           â— æ¥ç¶šä¸­ â”‚  â† ãƒ˜ãƒƒãƒ€ãƒ¼
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ pane:0 âœ¦ ] [ pane:1 ] [ pane:2 ] â”‚  â† pane ã‚¿ãƒ–
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  ~/project $ claude                 â”‚
â”‚                                     â”‚
â”‚  â— Claude Code                      â”‚
â”‚                                     â”‚
â”‚  I'll fix the authentication bug.   â”‚
â”‚  Let me first read the relevant     â”‚
â”‚  files...                           â”‚
â”‚                                     â”‚
â”‚  Read src/auth.ts                   â”‚
â”‚  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®    â”‚
â”‚  â”‚ Allow  â”‚  Deny  â”‚ Always   â”‚    â”‚
â”‚  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯    â”‚
â”‚                                     â”‚
â”‚                                     â”‚  â† xterm.js
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [^C] [^D] [â†‘] [â†“] [Tab]            â”‚  â† ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚­ãƒ¼
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [å…¥åŠ›...                         â ] â”‚  â† ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ãƒãƒ¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚µã‚¤ãƒ‰ãƒãƒ¼ (â˜° ã‚¿ãƒƒãƒ—æ™‚)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  â”‚                  â”‚
â”‚  ğŸ“‚ Sessions     â”‚  (èƒŒæ™¯æš—ã)       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                  â”‚
â”‚                  â”‚  ~/project $     â”‚
â”‚  â–¼ main          â”‚  claude          â”‚
â”‚    âœ¦ pane:0      â”‚                  â”‚
â”‚      pane:1      â”‚  â— Claude Code   â”‚
â”‚      pane:2      â”‚                  â”‚
â”‚                  â”‚                  â”‚
â”‚  â–¶ dev           â”‚                  â”‚
â”‚                  â”‚                  â”‚
â”‚  â–¶ monitor       â”‚                  â”‚
â”‚                  â”‚                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                  â”‚
â”‚  âš™ Settings      â”‚                  â”‚
â”‚                  â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ“ä½œæ–¹æ³•

| æ“ä½œ | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
|------|----------|
| â˜° ã‚¿ãƒƒãƒ— | ã‚µã‚¤ãƒ‰ãƒãƒ¼é–‹é–‰ |
| pane ã‚¿ãƒ–ã‚¿ãƒƒãƒ— | pane åˆ‡ã‚Šæ›¿ãˆ |
| å·¦å³ã‚¹ãƒ¯ã‚¤ãƒ— | pane åˆ‡ã‚Šæ›¿ãˆ |
| ã‚µã‚¤ãƒ‰ãƒãƒ¼å†… session ã‚¿ãƒƒãƒ— | session å±•é–‹/æŠ˜ã‚ŠãŸãŸã¿ |
| ã‚µã‚¤ãƒ‰ãƒãƒ¼å†… pane ã‚¿ãƒƒãƒ— | è©²å½“ pane ã«åˆ‡ã‚Šæ›¿ãˆ |
| å…¥åŠ›ãƒãƒ¼ | ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ› â†’ Enter ã§é€ä¿¡ |
| ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆãƒœã‚¿ãƒ³ | å¯¾å¿œã™ã‚‹ç‰¹æ®Šã‚­ãƒ¼ã‚’é€ä¿¡ |

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
phone-code/
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ requirements.md          # æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.js
â”‚
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ index.js                 # Express + WebSocket ã‚µãƒ¼ãƒãƒ¼
â”‚   â””â”€â”€ tmux.js                  # tmux CLI ãƒ©ãƒƒãƒ‘ãƒ¼
â”‚
â””â”€â”€ src/                         # React Frontend
    â”œâ”€â”€ main.jsx                 # ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ
    â”œâ”€â”€ App.jsx                  # ãƒ«ãƒ¼ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
    â”œâ”€â”€ App.css
    â”œâ”€â”€ hooks/
    â”‚   â””â”€â”€ useWebSocket.js      # WebSocket æ¥ç¶šç®¡ç†
    â””â”€â”€ components/
        â”œâ”€â”€ Terminal.jsx         # xterm.js ãƒ©ãƒƒãƒ‘ãƒ¼
        â”œâ”€â”€ Terminal.css
        â”œâ”€â”€ Sidebar.jsx          # ã‚»ãƒƒã‚·ãƒ§ãƒ³/pane ãƒ„ãƒªãƒ¼
        â”œâ”€â”€ Sidebar.css
        â”œâ”€â”€ TabBar.jsx           # pane ã‚¿ãƒ–ãƒãƒ¼
        â”œâ”€â”€ TabBar.css
        â”œâ”€â”€ InputBar.jsx         # ãƒ¢ãƒã‚¤ãƒ«å…¥åŠ›æ¬„
        â””â”€â”€ InputBar.css
```

---

## Docker æ§‹æˆ

### docker-compose.yml

```yaml
services:
  phone-code:
    build: .
    ports:
      - "${PORT:-3000}:3000"
    volumes:
      # ãƒ›ã‚¹ãƒˆã® tmux ã‚½ã‚±ãƒƒãƒˆã‚’ãƒã‚¦ãƒ³ãƒˆ
      - /tmp/tmux-${TMUX_UID:-1000}:/tmp/tmux-${TMUX_UID:-1000}
    user: "${TMUX_UID:-1000}:${TMUX_GID:-1000}"
    environment:
      - TMUX_SOCKET_PATH=/tmp/tmux-${TMUX_UID:-1000}/default
      - PORT=3000
    restart: unless-stopped
```

### Dockerfile

```dockerfile
FROM node:20-slim

RUN apt-get update && apt-get install -y tmux && rm -rf /var/lib/apt/lists/*

WORKDIR /app
COPY package*.json ./
RUN npm ci --production
COPY dist/ ./dist/
COPY server/ ./server/

EXPOSE 3000
CMD ["node", "server/index.js"]
```

### èµ·å‹•æ–¹æ³•

```bash
# ãƒ“ãƒ«ãƒ‰ & èµ·å‹•
TMUX_UID=$(id -u) TMUX_GID=$(id -g) docker compose up -d

# ãƒ­ã‚°ç¢ºèª
docker compose logs -f

# åœæ­¢
docker compose down
```

---

## Phase åˆ†ã‘

### Phase 1 (MVP)

- [x] è¦ä»¶å®šç¾©
- [x] tmux ã‚»ãƒƒã‚·ãƒ§ãƒ³/pane ä¸€è¦§è¡¨ç¤º
- [x] pane å‡ºåŠ›ã®è¡¨ç¤º (capture-pane ãƒãƒ¼ãƒªãƒ³ã‚°)
- [x] ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ› & ç‰¹æ®Šã‚­ãƒ¼é€ä¿¡
- [x] ã‚µã‚¤ãƒ‰ãƒãƒ¼ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆ
- [x] ã‚¿ãƒ– & ã‚¹ãƒ¯ã‚¤ãƒ—ã§ pane åˆ‡ã‚Šæ›¿ãˆ
- [x] ãƒ¢ãƒã‚¤ãƒ«å…¥åŠ›ãƒãƒ¼
- [x] Docker Compose å¯¾å¿œ

### Phase 2 (äºˆå®š)

- [ ] Claude Code ç‰¹åŒ– UI (æ‰¿èªãƒœã‚¿ãƒ³ç­‰)
- [ ] è¤‡æ•°ãƒã‚·ãƒ³å¯¾å¿œ (SSH çµŒç”±)
- [ ] èªè¨¼æ©Ÿèƒ½
- [ ] pane ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ
- [ ] ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å±¥æ­´
